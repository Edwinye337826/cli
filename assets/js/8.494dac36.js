(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{446:function(s,t,a){"use strict";a.r(t);var e=a(55),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"cli-deploy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cli-deploy"}},[s._v("#")]),s._v(" cli-deploy")]),s._v(" "),a("p",[s._v("项目发布是项目开发过程中，必不可少的一环。为了简化前端项目资源的部署步骤，避免繁琐的 shell 脚本编写及人为操作，"),a("code",[s._v("w6s-cli")]),s._v("根据常见的部署场景，提供了自动化部署的功能，支持开发、测试、生产多环境配置，一键即可自动完成部署。")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/WorkPlusFE/cli/tree/master/packages/%40w6s/cli-deploy",target:"_blank",rel:"noopener noreferrer"}},[s._v("仓库地址"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("p",[s._v("要使用发布功能，可以单独安装"),a("code",[s._v("@w6s/cli-deploy")]),s._v("，或者使用"),a("code",[s._v("w6s-cli")]),s._v("提供的"),a("code",[s._v("deploy")]),s._v("命令。")]),s._v(" "),a("p",[s._v("安装"),a("code",[s._v("@w6s/cli-deploy")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" global "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" @w6s/cli-deploy\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# or")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g @w6s/cli-deploy\n")])])]),a("h2",{attrs:{id:"初始化配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化配置文件"}},[s._v("#")]),s._v(" 初始化配置文件")]),s._v(" "),a("p",[s._v("安装成功后，执行以下命令:")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("w6s-cli-deploy init\n")])])]),a("p",[s._v("执行初始化命令后，会在当前目录生成"),a("code",[s._v("deploy.config.js")]),s._v("配置文件，具体配置内容和说明如下：")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  envConfig"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 名为 dev 的环境配置")]),s._v("\n    dev"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.0.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      distPath"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dist"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      uploadPath"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/workplus"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      privateKey"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      passphrase"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      preCommand"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm run build"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("所有的环境配置，都应添加到"),a("code",[s._v("envConfig")]),s._v("中，你可以根据实际情况，添加多个不同的环境配置。")]),s._v(" "),a("p",[s._v("以下为一个环境中可配置的所有字段的说明：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("host")])])]),s._v(" "),a("p",[s._v("服务器地址，如 192.168.0.1")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("port")])])]),s._v(" "),a("p",[s._v("ssh 的端口，一般默认 22")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("username")])])]),s._v(" "),a("p",[s._v("用户名，如 root")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("password")])])]),s._v(" "),a("p",[s._v("服务器密码，非必须，执行部署命令可以手动输入以确保信息安全")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("uploadPath")])])]),s._v(" "),a("p",[s._v("要部署到服务器的目录路径，应为绝对路径")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("privateKey")])])]),s._v(" "),a("p",[s._v("本地私钥地址，应为绝对路径，非必填；若有值，将会带密钥的方式进行 ssh 链接，否则使用账号密码的方式")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("passphrase")])])]),s._v(" "),a("p",[s._v("对应私钥的密码，非必须，可为空")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("preCommand")])])]),s._v(" "),a("p",[s._v("发布前需执行的命令，非必须")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("distPath")])])]),s._v(" "),a("p",[s._v("本地待上传的文件目录")]),s._v(" "),a("h2",{attrs:{id:"自动化部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动化部署"}},[s._v("#")]),s._v(" 自动化部署")]),s._v(" "),a("p",[a("code",[s._v("@w6s/cli-deploy")]),s._v("支持多环境发布，使用"),a("code",[s._v("deploy")]),s._v("命令，传入 env 环境名字，一键自动发布。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("w6s-cli-deploy deploy --env "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("环境名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),a("p",[s._v("例如发布到上方 dev 环境，执行以下命令即可：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("w6s-cli-deploy deploy --env dev\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);